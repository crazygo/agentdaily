import { ResearchResult } from '../types';

/**
 * Format research results as Markdown
 */
export function formatAsMarkdown(result: ResearchResult): string {
  const date = new Date(result.generatedAt);
  const dateStr = date.toISOString().split('T')[0];

  let md = `# Product Research Daily Report\n`;
  md += `Generated: ${result.generatedAt}\n\n`;

  // New Products Section
  md += `## ğŸ“¦ New Products Discovered\n\n`;
  if (result.newProducts.length === 0) {
    md += `_No new products found in this research cycle._\n\n`;
  } else {
    result.newProducts.forEach((product, index) => {
      md += `### ${index + 1}. ${product.title}\n`;
      md += `${product.description}\n\n`;
      if (product.url) md += `ğŸ”— [Visit](${product.url})\n`;
      if (product.category) md += `ğŸ“‚ Category: ${product.category}\n`;
      md += `ğŸ“ Source: ${product.source}\n\n`;
      md += `---\n\n`;
    });
  }

  // Whitelist Updates Section
  md += `## ğŸ”„ Whitelist Product Updates\n\n`;
  if (result.whitelistUpdates.length === 0) {
    md += `_No updates found for tracked products._\n\n`;
  } else {
    result.whitelistUpdates.forEach((update, index) => {
      md += `### ${index + 1}. ${update.productName}: ${update.title}\n`;
      md += `${update.description}\n\n`;
      md += `ğŸ·ï¸ Type: ${update.updateType}\n`;
      if (update.date) md += `ğŸ“… Date: ${update.date}\n`;
      if (update.url) md += `ğŸ”— [Read more](${update.url})\n`;
      md += `\n---\n\n`;
    });
  }

  // Technical Insights Section
  md += `## ğŸ’¡ Technical Insights & Leader Opinions\n\n`;
  if (result.insights.length === 0) {
    md += `_No new insights gathered._\n\n`;
  } else {
    result.insights.forEach((insight, index) => {
      md += `### ${index + 1}. ${insight.title}\n`;
      md += `${insight.description}\n\n`;
      if (insight.author) md += `âœï¸ Author: ${insight.author}\n`;
      md += `ğŸ“Œ Type: ${insight.type}\n`;
      md += `ğŸ“ Source: ${insight.source}\n`;
      if (insight.url) md += `ğŸ”— [Read more](${insight.url})\n`;
      if (insight.topics.length > 0) {
        md += `ğŸ·ï¸ Topics: ${insight.topics.join(', ')}\n`;
      }
      md += `\n---\n\n`;
    });
  }

  md += `\n---\n`;
  md += `*Report generated by Agent Code Daily - Powered by Claude Agent SDK*\n`;

  return md;
}

/**
 * Format research results for console output
 */
export function formatForConsole(result: ResearchResult): void {
  console.log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ“¦ NEW PRODUCTS DISCOVERED');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

  if (result.newProducts.length === 0) {
    console.log('No new products found in this research cycle.\n');
  } else {
    result.newProducts.forEach((product, index) => {
      console.log(`${index + 1}. ${product.title}`);
      console.log(`   ${product.description}`);
      if (product.category) console.log(`   ğŸ“‚ ${product.category}`);
      if (product.url) console.log(`   ğŸ”— ${product.url}`);
      console.log(`   ğŸ“ Source: ${product.source}\n`);
    });
  }

  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ”„ WHITELIST PRODUCT UPDATES');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

  if (result.whitelistUpdates.length === 0) {
    console.log('No updates found for tracked products.\n');
  } else {
    result.whitelistUpdates.forEach((update, index) => {
      console.log(`${index + 1}. ${update.productName}: ${update.title}`);
      console.log(`   ${update.description}`);
      console.log(`   ğŸ·ï¸ Type: ${update.updateType}`);
      if (update.date) console.log(`   ğŸ“… ${update.date}`);
      if (update.url) console.log(`   ğŸ”— ${update.url}`);
      console.log();
    });
  }

  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
  console.log('ğŸ’¡ TECHNICAL INSIGHTS & LEADER OPINIONS');
  console.log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

  if (result.insights.length === 0) {
    console.log('No new insights gathered.\n');
  } else {
    result.insights.forEach((insight, index) => {
      console.log(`${index + 1}. ${insight.title}`);
      console.log(`   ${insight.description}`);
      if (insight.author) console.log(`   âœï¸ ${insight.author}`);
      console.log(`   ğŸ“Œ ${insight.type} | ${insight.source}`);
      if (insight.url) console.log(`   ğŸ”— ${insight.url}`);
      if (insight.topics.length > 0) {
        console.log(`   ğŸ·ï¸ ${insight.topics.join(', ')}`);
      }
      console.log();
    });
  }

  console.log(`\nGenerated: ${result.generatedAt}`);
}
